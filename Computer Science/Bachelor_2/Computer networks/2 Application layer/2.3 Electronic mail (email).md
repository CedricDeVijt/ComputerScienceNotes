## 2.3.1 Components of Email Communication
### User Agents
- **User Agents**: Software tools allowing users to interact with their email, performing actions like reading, composing, replying, and forwarding messages.
### Mail Servers
- **Mail Servers**: Core infrastructure managing the storage, retrieval, and transfer of email messages.
- Role:
  - Each recipient, like Bob, has a mailbox within a mail server.
  - Manages messages sent to recipients.
- Message Journey:
  - Starts from the sender's user agent.
  - Travels to the sender's mail server.
  - Transferred to the recipient's mail server.
  - Deposited into the recipient's mailbox.
- Authentication:
  - Authentication of users like Bob with username and password.
  - Handling failures in recipient mail servers.
- Message Queuing:
  - Mail servers hold undelivered messages in a queue and attempt retransmission.
  - Reattempts occur periodically (e.g., every 30 minutes).
  - If unsuccessful after several days, the server notifies the sender and removes the message.
### Simple Mail Transfer Protocol (SMTP)
- **Simple Mail Transfer Protocol (SMTP)**: Principal application-layer protocol for Internet electronic mail.
- Role:
  - Facilitates the transfer of email from the sender's mail server to the recipient's mail server.
- Protocol Structure:
  - Client-side: Executes on the sender's mail server.
  - Server-side: Executes on the recipient's mail server.
- Underlying Technology: Relies on TCP's reliable data transfer service.

![[Screenshot 2024-03-18 at 14.40.06.png]]

## 2.3.2 SMTP: Heart of Email Communication
### Basic Operation
**Scenario**: Alice sending a simple ASCII message to Bob. 

![[Screenshot 2024-03-18 at 15.11.15.png]]

1. Alice utilises her email user agent, providing Bob's email address and composing the message.
2. Message is sent from Alice's user agent to her mail server, where it enters a message queue.
3. Alice's mail server, acting as an SMTP client, establishes a TCP connection with Bob's mail server.
4. SMTP client sends Alice's message through the TCP connection.
5. Bob's mail server, acting as an SMTP server, receives the message and places it in Bob's mailbox.
6. Bob reads the message using his user agent at his convenience.
### Direct Communication
- SMTP typically facilitates direct communication between sender and recipient mail servers.
- Even if mail servers are geographically distant, SMTP establishes a direct TCP connection.
- If the recipient's mail server is inaccessible, the message remains in the sender's mail server for future delivery attempts.

## 2.3.3 SMTP Message Transfer
### Protocol Overview
- **Similarities with Human Interaction**:
  - Client SMTP establishes a TCP connection with server SMTP.
  - Application-layer handshaking occurs, akin to human introductions before information exchange.
- **Data Transfer**: Relies on TCP's reliable data transfer service for error-free message delivery.
- **Connection Management**: Client repeats the process over the same TCP connection or instructs TCP to close it.
### Example Transcript
- **Participants**:
  - Client: crepes.fr
  - Server: hamburger.edu
- **Commands Issued by Client**:
  1. HELO
  2. MAIL FROM
  3. RCPT TO
  4. DATA
  5. QUIT
- **Message Format**:
  - Each message ends with CRLF.CRLF (carriage return, line feed, period).
- **Server Responses**:
  - Replies to each command with a reply code and optional explanation.
- **Persistent Connections**:
  - SMTP employs persistent connections for multiple messages to the same recipient server.
  - Client begins each message with MAIL FROM, designates message end with a period, and issues QUIT after all messages are sent.

![[Screenshot 2024-03-18 at 15.14.53.png]]


## 2.3.4 MIME Content Types

**Importance**: MIME specification primarily focuses on defining various content types to handle diverse information representations in a multimedia environment.
### Content Types Overview
- **Standardisation**: RFCs 2045 and 2046 specify a range of content types.
- **Major Types**: Seven major types of content.
- **Subtypes**: A total of 15 subtypes provide further granularity.
- **Declaration**: Content type declares the general type of data, while the subtype specifies a particular format for that data.
### Text Type
- **No Special Software Requirement**: Text type bodies can be understood with support for the indicated character set.
- **Primary Subtype**: Plain text, consisting of ASCII or ISO 8859 characters.
- **Enriched Subtype**: Offers enhanced formatting options.
### Multipart Type
- **Indicates Multiple Parts**: Used when the body contains multiple, independent parts.
- **Content-Type Header Field**: Includes a boundary parameter defining the delimiter between body parts.
- **Boundary Format**: Each boundary starts on a new line and consists of two hyphens followed by the boundary value.
- **Final Boundary**: Indicated by a suffix of two hyphens, marking the end of the last part.
- **Optional MIME Header**: Each part may contain an optional ordinary MIME header.

## 2.3.5 Email Message Delivery and Retrieval
### Direct Delivery vs. Shared Mail Server

![[Screenshot 2024-03-18 at 15.19.33.png]]
- **Local Mail Server**: Placing Bob's mail server on his local host seems practical but requires the host to remain always on and connected to the Internet, which is impractical for many users.
- **Shared Mail Server**: Users typically access their mailboxes stored on an always-on shared mail server rather than hosting their own mail server.
### Two-Step Procedure
- **Reasoning**: Alice's user agent deposits the email into her mail server first before relaying it to Bob's mail server.
- **Purpose**: Allows Alice's mail server to repeatedly attempt delivery to Bob's mail server until it becomes operational.
### Retrieving Email Messages
- **Challenge**: Bob's user agent cannot use SMTP to retrieve messages as SMTP is a push protocol.
- **Methods**:
  1. **HTTP**: Used for web-based email or smartphone apps like Gmail.
  2. **IMAP**: Commonly used with mail clients like Microsoft Outlook.
### HTTP Retrieval
- **Requirements**: Bob's mail server needs both HTTP and SMTP interfaces to communicate with Alice's mail server.
- **Functionality**: Allows Bob to manage folders, move messages, delete messages, mark messages, etc., all maintained on Bob's mail server.
### IMAP Retrieval
- **Defined in RFC 3501**: Internet Mail Access Protocol.
- **Functionality**: Similar to HTTP, enables Bob to manage folders and perform various actions on his email messages.