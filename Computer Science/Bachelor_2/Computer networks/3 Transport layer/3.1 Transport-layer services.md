## 3.1.1 Transport-Layer Protocol
### Logical Communication
- **Transport-layer protocol**: A protocol providing logical communication between application processes on different hosts.
- **Logical communication**: Hosts appear directly connected from an application's perspective, regardless of physical distance and network infrastructure.
### Implementation and Functionality
- **End systems**: Implement transport-layer protocols, not network routers.
- **Sending side**: 
  - Converts application-layer messages into transport-layer segments.
  - Segments are created by breaking messages into smaller chunks and adding transport-layer headers.
  - Passes the segment to the network layer, where it's encapsulated into a network-layer packet.
- **Receiving side**:
  - Network layer extracts the transport-layer segment from the packet and passes it to the transport layer.
  - Transport layer processes the segment, making data available to the receiving application.
### Protocol Stack
- **Protocol stack**: Transport layer lies just above the network layer.
- **Transport-layer protocol vs. Network-layer protocol**:
  - Transport-layer protocol: Provides logical communication between processes.
  - Network-layer protocol: Provides logical communication between hosts.
## 3.1.2 Internet Protocol (IP)

### IP Service Model
- **Best-effort delivery service**: IP makes its "best effort" to deliver segments between communicating hosts but makes no guarantees.
- **Unreliable service**: IP does not guarantee segment delivery, orderly delivery of segments, or integrity of data in segments.
### IP Address
- Every host has at least one network-layer address, known as an IP address.
## 3.1.3 User Datagram Protocol (UDP) and Transmission Control Protocol (TCP)

### Overview
- UDP (User Datagram Protocol) and TCP (Transmission Control Protocol) are two distinct transport-layer protocols available on the Internet.
- UDP provides an unreliable, connectionless service to the invoking application.
- TCP provides a reliable, connection-oriented service to the invoking application.
### Transport-Layer Multiplexing and Demultiplexing
- UDP and TCP extend IP's delivery service between two end systems to a delivery service between two processes running on the end systems.
- This process, called transport-layer multiplexing and demultiplexing, enables process-to-process data delivery.
### UDP Features
- **Minimal services**: UDP only provides process-to-process data delivery and error checking.
- **Unreliable service**: Like IP, UDP does not guarantee intact delivery of data sent by one process to the destination process.
### TCP Features
- **Reliable data transfer**: TCP ensures data is delivered from sending process to receiving process correctly and in order, using flow control, sequence numbers, acknowledgments, and timers.
- **Congestion control**: TCP prevents any one TCP connection from overwhelming links and routers between communicating hosts by regulating the rate at which data is sent.
- **Equal share of bandwidth**: TCP strives to give each connection traversing a congested link an equal share of the link bandwidth, unlike UDP traffic which is unregulated.
## 3.1.4 Transport Layer Data Delivery

### Intermediary Sockets
- **Sockets**: These are doors facilitating data exchange between the network and a process.
- **Receiving Data**: The transport layer doesn't deliver data directly to a process but to an intermediary socket.
### Demultiplexing
- **Definition**: It's the process of directing an incoming transport-layer segment to the appropriate socket.
- **Segment Fields**: Each segment contains fields used for identification.
- **Identifying Socket**: The transport layer examines these fields to identify the receiving socket.
- **Function**: This process is essential for delivering data to the correct destination.
### Multiplexing
- **Definition**: It involves gathering data from different sockets, encapsulating it with header information, and passing it to the network layer.
- **Purpose**: Prepares data for transmission efficiently.
- **Segment Creation**: Involves encapsulating data chunks with header information for later demultiplexing.
### Port Numbers
- **Unique Identifiers**: Sockets are identified by port numbers.
- **Source and Destination Port Numbers**: Each transport-layer segment contains these fields.
- **Range**: Port numbers are 16-bit, ranging from 0 to 65535.
- **Well-Known Ports**: Ports 0 to 1023 are reserved for well-known application protocols like HTTP (port 80) and FTP (port 21).
- **Assignment**: When developing a new application, assigning a port number is necessary.
## 3.1.5 UDP Socket Creation
### Port Number Assignment
- **Random Port Number**: Transport layer can assign a random port number (1024 to 65535).
- **Specific Port Number**: Developer can bind the socket to a specific port number.
- **Server Side**: Assigns well-known port numbers for well-known protocols.
- **Client Side**: Often lets transport layer assign port number automatically.
### UDP Multiplexing/Demultiplexing
- **Process Communication**: Describes how UDP segments are directed between processes.
- **Segment Structure**: Includes application data, source port number, destination port number, and other values.
- **Network Layer**: Encapsulates segment in an IP datagram and attempts delivery.
- **Receiving Host**: Examines destination port number to direct segment to the appropriate socket.
### Socket Identification
- **Two-Tuple Identification**: A UDP socket is identified by destination IP address and port number.
- **Segment Direction**: Segments with the same destination IP address and port number are directed to the same socket.
- **Source Port Number**: Serves as part of the "return address" for communication between hosts.
### Return Address
- **Purpose of Source Port Number**: Used as part of the return address for communication between hosts.
- **Return Address Structure**: Consists of A's IP address and the source port number when sending a segment back to A.

![[Screenshot 2024-03-21 at 12.58.34.png]]


## 3.1.6 TCP Demultiplexing and Connection Establishment
### TCP Socket Characteristics
- **Identification**: TCP sockets are identified by a four-tuple: (source IP address, source port number, destination IP address, destination port number).
- **Demultiplexing**: Host uses all four values to direct incoming TCP segments to the appropriate socket.
- **Contrast with UDP**: Unlike UDP, TCP segments with different source IP addresses or source port numbers are directed to different sockets.
### TCP Connection Establishment
1. **Welcoming Socket**: TCP server application has a welcoming socket waiting for connection-establishment requests.
2. **Client Request**: When a client wants to connect to the server, it creates its own socket and sends a TCP connection establishment request to the server's IP address and the port number associated with the welcoming socket.
3. **Request Structure**: The client's TCP segment (packet) includes the server's destination port number and sets the SYN flag in the TCP header to indicate that it's a connection establishment request.
4. **Server Response**: Host operating system locates the server process waiting on the specified port and establishes the connection.
5. **Connection Socket Identification**: Once the server accepts the connection, it creates a new socket specifically for this connection. This new socket is different from the welcoming socket and is used for the duration of the communication between the client and the server. New connection socket is identified by source port, source IP address, destination port, and server IP address.
### Multiple Simultaneous Connections
- **Server Support**: Server host may support multiple simultaneous TCP connection sockets, each attached to a process.
- **Demultiplexing Process**: Incoming TCP segments are directed to the appropriate socket using all four fields.
- **Illustration**: Illustrated scenario where multiple connections are initiated to server B from different hosts with varying source port numbers.
### Connection Socket and Processes
- **Correspondence**: Not always one-to-one between connection sockets and processes.
- **Web Server Example**: High-performing web servers may use a single process, creating a new thread with a new connection socket for each client connection.
- **Thread**: Lightweight subprocess used for managing connections.

![[Screenshot 2024-03-21 at 13.00.51.png]]
