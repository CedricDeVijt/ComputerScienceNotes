## 4.4.1 Routing Algorithms: Challenges and Solutions
### Simplistic Model
- **Homogeneous Routers**: 
  - Routers seen as identical entities.
  - All routers execute the same routing algorithm.
### Challenges
- **Scale**:
  - *Overhead*: 
    - Large number of routers leads to excessive communication, computation, and storage of routing information.
    - Internet comprises hundreds of millions of routers.
    - Storing routing information for each router requires massive memory resources.
    - Broadcasting updates among all routers incurs significant overhead.
  - *Convergence*:
    - Distance-vector algorithms struggle to converge in large networks.
  - *Complexity Reduction*: 
    - Necessary to simplify route computation in the vast Internet.
    
- **Administrative Autonomy**:
  - *Internet Structure*:
    - ISPs operate distinct networks of routers.
  - *Desired Autonomy*: 
    - ISPs aim to operate their networks independently.
    - Desire to run preferred routing algorithms within their networks.
    - Need to conceal internal network structure.
  - *Connectivity Requirement*:
    - Necessity to connect networks while maintaining autonomy.    
### Solutions
- **Autonomous Systems (ASs)**:
  - *Definition*:
    - Group of routers under the same administrative control.
  - *ISP Networks*:
    - Often, an ISP's routers and links form a single AS.
    - Some ISPs divide their network into multiple ASs.
  - *AS Identification*:
    - Identified by unique Autonomous System Number (ASN).
    - Assigned by ICANN regional registries.
  - *Routing Protocol*:
    - Routers within the same AS run the same routing algorithm.
    - Share information about each other.
    - Intra-autonomous system routing protocol governs routing within an AS.

## OSPF and IS-IS: Intra-AS Routing
### OSPF Overview
- **Usage**:
  - Widely adopted for intra-AS routing in the Internet.
- **Open Specification**:
  - *OSPFOpen*:
    - "Open" signifies the availability of the routing protocol specification to the public.
  - *Comparison with EIGRP*:
    - Unlike Cisco's EIGRP, OSPF's specification has been publicly available.
    - EIGRP recently became open after approximately 20 years as a Cisco-proprietary protocol.
- **Versioning**:
  - Most recent version: OSPF version 2.
  - Defined in [RFC 2328], a public document. 
### IS-IS Relationship
- **Closely Related**:
  - IS-IS serves as a closely related cousin to OSPF.
- **Similar Usage**:
  - Also widely utilized for intra-AS routing in the Internet.

## 4.4.2 OSPF Protocol Features

### Basic Operation
- **Protocol Type**:
  - OSPF operates as a link-state protocol.
- **Routing Algorithm**:
  - Utilises Dijkstra’s least-cost path algorithm.
- **Topology Construction**:
  - Each router constructs a complete topological map of the entire autonomous system (AS).
  - Locally runs Dijkstra’s algorithm to determine shortest-path tree to all subnets.
### Link Weights Configuration
- **Administered by Network Administrator**:
  - Individual link costs configured by the administrator.
- **Routing Control**:
  - Link costs influence routing decisions.
  - Options include minimum-hop routing or weighting links based on capacity to discourage low-bandwidth usage.
### Routing Information Broadcasting
- **Scope**:
  - Broadcasts routing information to all routers in the autonomous system.
- **Trigger Events**:
  - Broadcasts occur on link state changes (e.g., cost or status changes).
  - Periodic broadcasts at least once every 30 minutes, even if there are no changes.
- **Mechanism**:
  - OSPF messages carried directly by IP, with an upper-layer protocol of 89.
  - OSPF protocol implements reliable message transfer and link-state broadcast.
### Protocol Advancements
- **Security**:
  - Authentication mechanisms prevent unauthorised participation.
  - Options include simple authentication and MD5 authentication for packet verification and protection against replay attacks.
- **Load Balancing**:
  - OSPF allows multiple paths to be used when multiple paths to a destination have the same cost.
- **Multicast Support**:
  - Multicast OSPF (MOSPF) provides extensions for multicast routing using existing OSPF mechanisms.
- **Hierarchical Organization**:
  - OSPF AS can be hierarchically configured into areas.
  - Each area runs its own OSPF link-state routing algorithm.
  - Area border routers handle routing between areas, with one area designated as the backbone for inter-area routing.

## 4.4.3 Inter-Autonomous System Routing: Border Gateway Protocol (BGP)

### Protocol Overview
- **Functionality**:
  - Handles routing across multiple autonomous systems (ASs).
- **Standardization**:
  - Defined in [RFC 4271].
- **Decentralized Nature**:
  - Operates as a decentralized and asynchronous protocol.
- **Routing Paradigm**:
  - Similar to distance-vector routing.
### BGP in the Internet
- **Uniform Adoption**:
  - All ASs in the Internet utilize BGP for inter-AS routing.
### AS Structure
- **Topology**:
  - Illustrates a network with three autonomous systems: AS1, AS2, and AS3.
- **Gateway vs. Internal Routers**:
  - *Gateway Router*:
    - Located on the AS edge.
    - Directly connects to routers in other ASs.
  - *Internal Router*:
    - Connects only to hosts and routers within its own AS.
### Example AS Configuration
- **AS1**:
  - *Gateway Router*: Router 1c.
  - *Internal Routers*: Routers 1a, 1b, and 1d.
- **AS2**:
  - Configured similarly with its own gateway and internal routers.
- **AS3**:
  - Contains a subnet with prefix x.

![[Screenshot 2024-04-04 at 16.55.04.png]]

## 4.4.4 BGP Routing Mechanism

### BGP Connection Establishment
- **TCP Connections**:
  - Routing information exchanged over semi-permanent TCP connections.
  - Port 179 used for BGP communication.
- **BGP Connection**:
  - Refers to a TCP connection and all BGP messages transmitted over it.
### BGP Session Types
- **External BGP (eBGP)**:
  - Connection between routers in different ASs.
- **Internal BGP (iBGP)**:
  - Connection between routers within the same AS.
### Connection Configuration
- **eBGP Connections**:
  - Established between gateway routers in different ASs.
  - Example: eBGP connections between routers 1c and 2a, and routers 2c and 3a.
- **iBGP Connections**:
  - Created between routers within each AS.
  - Commonly configured as a mesh of TCP connections within the AS.
  - Note: iBGP connections may not correspond to physical links.
### Routing Information Propagation
- **Reachability Information**:
  - Process of advertising reachability information for a prefix (e.g., prefix x) to routers within AS1 and AS2.
- **Propagation Steps**:
  1. Gateway router 3a sends an eBGP message "AS3 x" to gateway router 2c.
  2. Gateway router 2c forwards the iBGP message "AS3 x" to all routers in AS2, including gateway router 2a.
  3. Gateway router 2a sends an eBGP message "AS2 AS3 x" to gateway router 1c.
  4. Gateway router 1c uses iBGP to distribute the message "AS2 AS3 x" to all routers in AS1.
- **Result**:
  - Each router in AS1 and AS2 becomes aware of the existence of prefix x and an AS path leading to it.

![[Screenshot 2024-04-04 at 16.56.37.png]]


## 4.4.5 BGP Route Advertisement and Attributes

### Route Propagation Process
- **Objective**:
  - Propagating reachability information (e.g., prefix x) to all routers in AS1 and AS2.
- **Propagation Steps**:
  1. Gateway router 3a sends eBGP message "AS3 x" to gateway router 2c.
  2. Gateway router 2c forwards iBGP message "AS3 x" to all routers in AS2, including router 2a.
  3. Router 2a sends eBGP message "AS2 AS3 x" to gateway router 1c.
  4. Gateway router 1c distributes message "AS2 AS3 x" using iBGP to all routers in AS1.
### BGP Attributes
- **Definition**:
  - Prefix along with its associated attributes constitute a route in BGP.
- **Key Attributes**:
  - AS-PATH
  - NEXT-HOP
### AS-PATH Attribute
- **Purpose**:
  - Contains the list of ASs through which the advertisement has traversed.
- **Generation**:
  - Each AS appends its ASN to the existing AS-PATH when passing the prefix.
- **Loop Prevention**:
  - Routers use AS-PATH to detect and prevent looping advertisements.
  - If a router sees its own AS in the path list, it rejects the advertisement.
### NEXT-HOP Attribute
- **Functionality**:
  - Indicates the IP address of the router interface that begins the AS-PATH.
- **Significance**:
  - Crucial link between inter-AS and intra-AS routing protocols.
  - Guides routing decisions within ASs.


## 4.4.6 BGP Route Selection Algorithm
### Input
- **Routes Set**:
  - All routes to a given destination prefix accepted by the router.
### Route Selection Rules
1. **Local Preference**:
   - Assigns a local preference value to each route.
   - Value set by the router or learned from another router in the same AS.
   - Policy decision left to the AS's network administrator.
   - Routes with the highest local preference values are selected.
   
2. **AS-PATH Length**:
   - Shortest AS-PATH among routes with the highest local preference.
   - Emphasizes shortest AS-hops route selection.

3. **NEXT-HOP Proximity**:
   - Closer NEXT-HOP router among routes with the same highest local preference and AS-PATH length.
   
4. **BGP Identifiers**:
   - Used if multiple routes still remain after applying previous rules.
### Example Scenario: Router 1b
- **Routes to Prefix x**:
  - Two BGP routes: one passing through AS2, and one bypassing AS2.
- **Route Selection**:
  - Rule 2 applied first: selects the route bypassing AS2 due to shorter AS-PATH.
- **Observation**:
  - BGP prioritizes routes with shorter AS paths, potentially reducing end-to-end delay.

![[Screenshot 2024-04-04 at 17.00.03.png]]


## 4.4.7 BGP and IP-Anycast: Implementation in DNS
### Introduction
- **Role of BGP**:
  - Beyond inter-AS routing, BGP facilitates IP-anycast service implementation.
- **Motivation**:
  - Efficient content replication and access from the closest server in dispersed geographical locations.
### IP-Anycast Configuration
- **DNS Example**:
  - DNS operators assign the same IP address to multiple servers.
  - Standard BGP used to advertise this IP address from each server.
### BGP Route Advertisement
- **Advertisement Interpretation**:
  - BGP routers view multiple route advertisements as paths to the same physical location.
- **Route Selection**:
  - Each router applies BGP route-selection algorithm to choose the "best" route.
  - Factors like AS-hop counts determine the closeness of the route.
### DNS Implementation
- **Functionality**:
  - IP-anycast utilized by DNS to direct queries to the closest root DNS server.
- **Routing Decision**:
  - Each router selects the route based on BGP's route-selection algorithm, directing queries to the nearest DNS server.













