## 4.1.1 The Internet's Network Layer
### Responsibility
- **Network Layer**: Responsible for moving network-layer packets (datagrams) from one host to another.
### Interaction with Transport Layer
- When a transport-layer protocol (TCP or UDP) in a source host sends a transport-layer segment with a destination address to the network layer, it's akin to giving a letter with an address to the postal service.
- The network layer then delivers the segment to the transport layer in the destination host.
### Components
- **IP Protocol**: Defines the fields in the datagram and governs how end systems and routers act on these fields.
- There is only one IP protocol, and all Internet components with a network layer must run it.
### Routing Protocols
- Routing protocols determine the routes that datagrams take between sources and destinations.
- The Internet has multiple routing protocols.
- Within a network, the network administrator can choose and implement any desired routing protocol.
### Terminology
- While the network layer encompasses both the IP protocol and various routing protocols, it's commonly referred to as the IP layer. This reflects the pivotal role of IP in connecting the Internet's diverse components.

## 4.1.2 Network Layer Functions: Forwarding and Routing

### Forwarding
- **Definition**:
  - When a packet arrives at a router's input link, the router must move the packet to the appropriate output link.
  - Forwarding is a critical function implemented in the data plane.
- **Variations**:
  - In addition to straightforward forwarding, packets might be blocked or duplicated based on various conditions.
### Routing
- **Definition**:
  - The network layer determines the route or path taken by packets as they move from sender to receiver.
  - Implemented in the control plane.
- **Routing Algorithms**:
  - Algorithms used to calculate these paths are called routing algorithms.
### Precision in Terminology
- **Forwarding vs. Routing**:
  - Often used interchangeably but distinguished precisely here.
  - **Forwarding**: Local action of transferring a packet from input link interface to the appropriate output link interface.
    - Takes place on very short timescales (nanoseconds) and typically implemented in hardware.
  - **Routing**: Network-wide process determining end-to-end paths from source to destination.
    - Takes place on longer timescales (seconds) and often implemented in software.

![[Screenshot 2024-04-04 at 15.51.55.png]]

## 4.1.3 Forwarding Tables in Network Routers

### Functionality
- **Role**: Key element in every network router.
- **Operation**:
  - Router forwards a packet by examining one or more fields in the packet's header.
  - Uses these header values to index into its forwarding table.
  - Forwarding table entry indicates the outgoing link interface for the packet.
### Example Scenario
- **Example**:
  - Packet with header field value of 0110 arrives at a router.
  - Router indexes into its forwarding table and determines output link interface (e.g., interface 2).
  - Router forwards the packet internally to interface 2.
### Configuration of Forwarding Tables
- **Importance**:
  - Exposes the interplay between forwarding (data plane) and routing (control plane).
- **Routing Algorithm**:
  - Determines contents of routers' forwarding tables.
- **Integration**:
  - Both forwarding and routing functions are contained within a router.
  - Routing algorithm runs in each router to configure forwarding tables.
  - Communication between routing algorithm functions in different routers aids in computing forwarding table values.

![[Screenshot 2024-04-04 at 15.56.43.png]]

## 4.1.4 Alternative Control-Plane Approach: Software-Defined Networking (SDN)

### Concept Overview
- **Remote Controller**:
  - Computes and distributes forwarding tables to routers.
  - Control-plane routing functionality separated from physical routers.
  - Routing devices focus solely on forwarding.
### Communication between Routers and Remote Controller
- **Message Exchange**:
  - Routers and remote controller communicate by exchanging messages.
  - Messages contain forwarding tables and other routing information.
### Implementation Details
- **Remote Controller Location**:
  - Might be situated in a remote data center with high reliability and redundancy.
  - Managed by the ISP or a third party.
### Key Feature: Software-Defined Networking (SDN)
- **Definition**:
  - Network is "software-defined" because the controller computing forwarding tables and interacting with routers is implemented in software.
- **Benefits**:
  - Centralised control enables easier network management and optimization.

![[Screenshot 2024-04-04 at 15.57.49.png]]


## 4.1.5 Router Components

### Input Ports
- **Functions**:
  - Terminates incoming physical links at the router (physical layer function).
  - Performs link-layer functions for interoperability with the link layer at the other side of the link.
  - Crucially, performs a lookup function to consult the forwarding table for determining the output port.
- **Forwarding Control**:
  - Forwards control packets (e.g., routing protocol information) to the routing processor.
### Switching Fabric
- **Role**:
  - Connects input ports to output ports within the router.
  - Entirely contained within the router, forming a network inside the router itself.
### Output Ports
- **Functions**:
  - Stores packets received from the switching fabric.
  - Transmits packets on outgoing links by performing necessary link-layer and physical-layer functions.
- **Bidirectional Links**:
  - Paired with input ports for bidirectional links on the same line card.
### Routing Processor
- **Control-Plane Functions**:
  - Executes routing protocols.
  - Maintains routing tables and attached link state information.
  - Computes the forwarding table for the router in traditional routers.
  - In SDN routers, communicates with the remote controller to receive forwarding table entries and install them in input ports.

![[Screenshot 2024-04-04 at 15.59.44.png]]

## 4.1.6 Forwarding Table Optimisation

### Scalability Challenge
- **Issue**:
  - Brute-force implementation of forwarding table with one entry for every possible destination address is impractical due to over 4 billion possible addresses.
### Prefix-Based Forwarding Table
- **Concept**:
  - Forwarding decisions based on packet's destination address.
  - Instead of individual addresses, entries in the table represent ranges of addresses using prefixes.
### Example Scenario
- **Router Configuration**:
  - Router has four links, numbered 0 through 3.
- **Forwarding Table**:
  - Contains only four prefix entries corresponding to address ranges.
- **Functionality**:
  - Router matches a prefix of the packet's destination address with entries in the table.
  - If there's a match, the router forwards the packet to the link associated with the matching entry.
### Advantages
- **Scalability**:
  - Significantly reduces the number of entries needed in the forwarding table.
- **Efficiency**:
  - Simplifies forwarding decisions without sacrificing accuracy.


## 4.1.7 Packet Queuing in Routers

### Introduction
- **Queue Formation**:
  - Packet queues may form at both input and output ports due to traffic load, switching fabric speed, and line speed.
### Input Port Queues
- **Scenario**:
  - Packet queuing occurs if switch fabric isn't fast enough relative to input line speeds.
- **Phenomenon**:
  - **Head-of-the-Line (HOL) Blocking**:
    - Queued packets must wait for transfer through the fabric, even if their output port is free.
    - Example scenario illustrates how HOL blocking occurs.
### Output Port Queues
- **Scenario**:
  - Switching speed is significantly faster than line speed.
- **Phenomenon**:
  - **Output Port Queueing**:
    - If multiple packets arrive at input ports destined for the same output port, queues form at the output port.
    - Even with a fast switching fabric, queues form due to the arrival rate of packets exceeding the transmission rate of the output port.
### Implications
- **Memory Exhaustion**:
  - Large queues can exhaust router memory, leading to packet loss when no memory is available to store arriving packets.
- **Performance Impact**:
  - Queueing delays can impact overall network performance, especially during periods of high traffic load.

![[Screenshot 2024-04-04 at 16.02.38.png]]

## 4.1.8 Packet Scheduling Disciplines

### FIFO (First-In-First-Out) Scheduling
- **Operation**:
  - Selects packets for link transmission in the same order they arrived at the output link queue.
- **Principle**:
  - Maintains the order of packet transmission based on arrival time.

![[Screenshot 2024-04-04 at 16.06.26.png]]
### Priority Queuing
- **Classification**:
  - Packets are categorised into priority classes upon arrival at the queue.
  - Network management packets may receive priority over user traffic.
  - Real-time voice-over-IP packets might receive priority over non-real-time traffic like email.
- **Queue Organisation**:
  - Each priority class typically has its own queue.
- **Transmission Selection**:
  - Highest priority nonempty queue is serviced first, followed by lower priority queues in a FIFO manner within each class.
![[Screenshot 2024-04-04 at 16.06.58.png]]
### Round Robin Queuing
- **Classification**:
  - Similar to priority queuing, packets are sorted into classes.
- **Service Allocation**:
  - Alternates service among classes in a cyclic manner.
  - Simplest form alternates between classes without considering priority.
### Weighted Fair Queuing (WFQ)
- **Generalized Round Robin**:
  - Arriving packets are classified and queued into appropriate waiting areas.
- **Service Allocation**:
  - Each class is assigned a weight.
  - During any interval, class i receives a fraction of service equal to its weight (wi) divided by the sum of weights of all classes (âˆ‘wi).
- **Differential Service**:
  - Each class may receive a differential amount of service based on its assigned weight under WFQ.

![[Screenshot 2024-04-04 at 16.07.14.png]]

# Next up
[[4.2 The Internet Protocol (IPv4 and IPv6)]]