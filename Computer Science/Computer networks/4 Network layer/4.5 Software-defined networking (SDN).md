## Destination-Based Forwarding vs. Match-Plus-Action Paradigm

### Destination-Based Forwarding:
- **Match**: Looking up a destination IP address.
- **Action**: Sending the packet into the switching fabric to the specified output port.

### General "Match-Plus-Action" Paradigm:
- **Match**: Can be made over multiple header fields associated with different protocols at different layers in the protocol stack.
- **Action**:
  - Forwarding the packet to one or more output ports.
  - Load balancing packets across multiple outgoing interfaces leading to a service.
  - Rewriting header values (NAT).
  - Blocking/dropping a packet (firewall).
  - Sending a packet to a special server for further processing and action (deep packet inspection), and more.
## Generalized Forwarding and Packet Switches
- In generalized forwarding, a match-plus-action table generalizes the notion of the destination-based forwarding table.
- Forwarding decisions may involve network-layer and/or link-layer source and destination addresses.
- Forwarding devices are more accurately described as "packet switches" rather than layer 3 "routers" or layer 2 "switches."
## Implementation and Control
- Packet switches are controlled by a remote controller.
- The match-plus-action table is computed, installed, and updated by the remote controller.
- While individual packet switches' control components can interact, in practice, generalized match-plus-action capabilities are implemented via a remote controller.

![[Screenshot 2024-04-12 at 17.18.30.png]]

## OpenFlow and Generalized Forwarding

### Flow Table Structure in OpenFlow
- Each entry in the match-plus-action forwarding table, known as a flow table in OpenFlow, includes:
  - A set of header field values for matching incoming packets.
  - Counters updated as packets are matched to flow table entries.
  - Actions to be taken when a packet matches a flow table entry.
### Matching and Wildcards
- OpenFlow allows matching on selected fields from three layers of protocol headers.
- Flow table entries may have wildcards, matching a range of values.
- Each entry has an associated priority; the highest priority entry with which the packet matches determines the action.
### Actions in Flow Table Entries
- Forwarding:
  - Forward packet to a particular physical output port.
  - Broadcast over all ports or multicast over a selected set of ports.
  - Encapsulate and send to the remote controller for further processing.
- Dropping:
  - Indicates that a matched packet should be dropped.
- Modify-field:
  - Rewrite values in packet-header fields (layer 2, 3, and 4 fields except the IP Protocol field) before forwarding.
### Header Fields and Wildcards
- OpenFlow 1.0 allows matching on 10 packet-header fields and the incoming port ID.
- The ingress port refers to the input port at the packet switch where a packet is received.
- Ethernet addresses are used for forwarding, enabling the device to function as both a router and a switch.
- The Ethernet type field corresponds to the upper layer protocol (e.g., IP).
- VLAN fields are concerned with virtual local area networks.

![[Screenshot 2024-04-12 at 17.21.22.png]]
### OpenFlow example network topology

![[Screenshot 2024-04-12 at 17.22.47.png]]


## Components of the SDN Control Plane
### SDN Controller Functionality
#### Communication Layer
- Facilitates communication between the SDN controller and controlled network devices.
- Enables transfer of information between the controller and devices.
- Local events (e.g., link status changes, device joins, heartbeat signals) are communicated to the controller, providing an up-to-date network state.
- Communication occurs via the controller's "southbound" interface.
- OpenFlow protocol is commonly used for this communication.
#### Network-wide State-Management Layer
- Manages the overall state of the network.
- Provides up-to-date information about hosts, links, switches, and other SDN-controlled devices.
- Essential for making control decisions such as configuring flow tables, implementing load balancing, and firewalling.
- Switch flow tables contain counters that may be utilized by network-control applications.
- The controller might maintain a copy of these flow tables.
#### Interface to the Network-Control Application Layer
- Allows interaction between the controller and network-control applications.
- Known as the "northbound" interface.
- Provides APIs for network-control applications to read/write network state and flow tables.
- Applications can register to be notified of state-change events and take actions accordingly.
- APIs may include REST or request-response interfaces.

![[Screenshot 2024-04-12 at 17.28.11.png]]

## OpenFlow Protocol Messages
### Messages from Controller to Controlled Switch
- **Configuration**: Allows querying and setting switch configuration parameters.
- **Modify-State**: Adds, deletes, or modifies entries in the switch's flow table and sets switch port properties.
- **Read-State**: Collects statistics and counter values from the switch's flow table and ports.
- **Send-Packet**: Sends a specific packet out of a specified port at the controlled switch. The packet itself is included in the message payload.
### Messages from Controlled Switch to Controller
- **Flow-Removed**: Informs the controller that a flow table entry has been removed, for example, due to a timeout or a received modify-state message.
- **Port-Status**: Informs the controller of a change in port status.
- **Packet-In**: A packet arriving at a switch port and not matching any flow table entry is sent to the controller for additional processing. Matched packets may also be sent to the controller as an action to be taken on a match. The packet-in message is used to send such packets to the controller.
## Interaction between SDN-Controlled Switches and SDN Controller
### Scenario Description
- Utilizing Dijkstra's algorithm to determine shortest path routes in an SDN environment.
- Notable differences from per-router-control scenario:
  - Dijkstra's algorithm executed as a separate application outside of packet switches.
  - Packet switches send link updates to SDN controller, not to each other.
- Link failure between switches s1 and s2 leads to affected flow forwarding rules at s1, s3, and s4.
### Steps in Interaction:
1. **Link-State Change Notification**:
   - Switch s1 notifies SDN controller of link-state change using OpenFlow port-status message.
2. **Controller Response**:
   - SDN controller receives OpenFlow message indicating link-state change.
   - Notifies link-state manager, updating link-state database.
3. **Network-Control Application Notification**:
   - Network-control application implementing Dijkstra's routing receives notification of link-state change.
4. **Path Computation**:
   - Routing application interacts with link-state manager to obtain updated link state.
   - Computes new least-cost paths.
5. **Flow Table Update Request**:
   - Routing application interacts with flow table manager to determine flow tables needing updates.
6. **Flow Table Update**:
   - Flow table manager uses OpenFlow protocol to update flow table entries at affected switches (s1, s2, s4).
     - s1: Routes packets destined to s2 via s4.
     - s2: Begins receiving packets from s1 via intermediate switch s4.
     - s4: Forwards packets from s1 destined to s2.

![[Screenshot 2024-04-12 at 17.32.28.png]]



























