
## 3.5.1 End-to-End Congestion Control

### End-to-End Approach
- **TCP**: Adopts end-to-end approach for congestion control.
  - **Definition**: Network layer doesn't provide explicit support to transport layer for congestion control.
  - **Indicators of Congestion**: Packet loss and delay are observed to infer network congestion.
  - **TCP Behavior**: Reacts to segment loss (timeout or three duplicate acknowledgments) by decreasing window size, assuming network congestion.
## 3.5.2 Network-Assisted Congestion Control

### Routers' Feedback
- **Explicit Feedback**: Routers provide feedback to sender and/or receiver about network congestion.
- **Simple Feedback**: Early architectures like IBM SNA, DEC DECnet, and ATM networks use basic indicators like a single bit for congestion.
- **Sophisticated Feedback**: Examples include ATM's Available Bite Rate (ABR) congestion control.
  - **ABR**: Router informs sender of maximum host sending rate it can support on an outgoing link.
### IP and TCP Behavior
- **End-to-End Approach**: Default behavior in Internet versions of IP and TCP.
- **Optional Implementation**: Recent versions may also incorporate network-assisted congestion control.

## 3.5.3 TCP Congestion Control

### Rate Limitation and Perception of Congestion
- **Rate Limitation**:
  - TCP sender limits send rate based on perceived network congestion.
  - Questions:
    - How does the sender limit the rate?
    - How does it perceive congestion?
    - What algorithm adjusts the send rate?
- **Congestion Window (cwnd)**:
  - Additional variable in TCP sender's congestion-control mechanism.
  - Limits the rate of sending traffic into the network.
  - Constraint: $LastByteSent - LastByteAcked <= min(cwnd, rwnd)$.
  - Adjusting cwnd adjusts the send rate.
### Congestion Perception

- **Loss Event**:
  - Defined as timeout or receipt of three duplicate ACKs.
  - Indication of congestion: Datagram containing TCP segment dropped due to router buffer overflow.
  - Loss event at sender signifies congestion on sender-to-receiver path.

- **Congestion-Free Network**:
  - No loss event occurs.
  - Arrival of acknowledgments for unacknowledged segments indicates successful delivery.
  - TCP increases congestion window size based on acknowledgment arrivals.
### TCP Congestion Control Algorithm

- **Overview**:
  - Standardised in [RFC 5681].
  - Three major components: slow start, congestion avoidance, and fast recovery.
  - Slow start and congestion avoidance are mandatory, while fast recovery is optional.
- **Components**:
  - **Slow Start**: Rapidly increases cwnd in response to received ACKs.
  - **Congestion Avoidance**: Increases cwnd more gradually compared to slow start.
  - **Fast Recovery**: Recommended but not required for TCP senders.

## 3.5.4 State 1: Slow Start

### Initialisation
- **Initial Value of cwnd**:
  - Typically initialised to 1 MSS (Maximum Segment Size).
  - Results in an initial sending rate of roughly MSS/RTT.
### Slow Start Process
- **Exponential Growth**:
  - Value of cwnd increases by 1 MSS for each acknowledged segment during slow start.
  - Sending rate doubles every RTT.

- **Example**:
  - TCP sends first segment and waits for acknowledgment.
  - Upon acknowledgment, sender increases cwnd by 1 MSS and sends two maximum-sized segments.
  - Acknowledgments further increase cwnd, leading to exponential growth.
### Ending Slow Start
- **Loss Event**:
  - Indicated by timeout.
  - cwnd is set to 1, and slow start process restarts.
  - ssthresh is set to cwnd/2.

- **Threshold Reached**:
  - When cwnd equals ssthresh, slow start ends.
  - TCP transitions to congestion avoidance mode.

- **Duplicate ACKs**:
  - Detection triggers fast retransmit and enters fast recovery state.

![[Screenshot 2024-04-04 at 10.28.54.png]]

## 3.5.5 State 2: TCP Congestion Avoidance

### Entry to Congestion Avoidance
- **Initial cwnd Value**:
  - Approximately half its value when last congestion was encountered.

- **Conservative Approach**:
  - Increase cwnd by 1 MSS every RTT instead of doubling.
  - Increase of MSS bytes (MSS/cwnd) upon each new acknowledgment.
### Example
- **Illustration**:
  - If MSS = 1,460 bytes and cwnd = 14,600 bytes, 10 segments are sent within an RTT.
  - Each ACK increases cwnd by 1/10 MSS.

### Ending Congestion Avoidance
- **Timeout Occurrence**:
  - Behavior similar to slow start.
  - cwnd set to 1 MSS, ssthresh updated to half cwnd when loss event occurred.

- **Triple Duplicate ACKs**:
  - Less drastic response compared to timeout.
  - cwnd halved (adding 3 MSS for triple duplicate ACKs), ssthresh updated to half cwnd when duplicate ACKs occurred.
  - Enters fast-recovery state.

## 3.5.6 State 3: Fast Recovery

### Increase of cwnd
- **Increment**: 
  - 1 MSS for every duplicate ACK received for the missing segment.
- **Transition**: 
  - To congestion-avoidance state after receiving ACK for the missing segment.
### Timeout Event
- **Transition**: 
  - To slow-start state.
- **Actions**: 
  - Set cwnd to 1 MSS.
  - Set ssthresh to half cwnd when loss event occurred.
### TCP Versions

- **TCP Tahoe**:
  - Early version unconditionally cuts congestion window to 1 MSS.
  - Enters slow-start phase after loss event.

- **TCP Reno**:
  - Incorporates fast recovery.
  - Recommended component but not mandatory.
### Evolution of Congestion Window

- **Graph Illustration**:
  - Shows evolution for both Reno and Tahoe.
  - Initial threshold: 8 MSS.
  - Exponential climb during slow start.
  - Linear climb after reaching threshold.
  - Transition to fast recovery at loss event.
  - Different responses in congestion window adjustment between Reno and Tahoe.

![[Screenshot 2024-04-04 at 10.31.42.png]]

## 3.5.7 TCP Congestion Control FSM (Finite State Machine)

### Description
- **Components**:
  - Slow start, congestion avoidance, and fast recovery algorithms.
  - Indicates transmission points for new or retransmitted segments.
### Relationship between Congestion Control and Error Control
- **Inextricable Link**:
  - Important to distinguish between TCP error control/retransmission and congestion control.
  - Appreciation of how these aspects are interconnected in TCP operation.

![[Screenshot 2024-04-04 at 10.32.55.png]]

## 3.5.8 TCP Congestion Control: AIMD Approach

### Description
- **Linear Increase and Multiplicative Decrease**:
  - Additive-increase, multiplicative-decrease (AIMD) approach.
  - Linear increase of 1 MSS per RTT.
  - Halving of cwnd on triple duplicate-ACK event.
### TCP CUBIC
- **Approach**:
  - Probing for packet sending rate just below the threshold of triggering packet loss.
  - Quick ramp-up to pre-loss sending rate.
  - Cautious bandwidth probing thereafter.

- **Difference from TCP Reno**:
  - Similar slow start and fast recovery phases.
  - Congestion avoidance phase differs.
### CUBIC Algorithm
- **Parameters**:
  - $W_{max}$: Congestion window size when loss last detected.
  - K: Future point when window size reaches $W_{max}$.
  - Tunable parameters determine K.

- **Congestion Window Adjustment**:
  - Increases as a function of cube of distance between current time and K.
  - Rapid increase when far from K.
  - Slower increase when close to K.
### Graph Comparison

- **TCP Reno vs. CUBIC**:
  - Slow start ends at t0.
  - Congestion loss at t1, t2, and t3.
  - CUBIC ramps up close to $W_{max}$ quickly.
  - Presumably achieves higher sending rates than $W_{max}$ due to decreased congestion level at t3.

![[Screenshot 2024-04-04 at 10.34.17.png]]


## 3.5.9 Fairness of TCP's AIMD Algorithm

### Definition
- *Fairness*:
  - Average transmission rate of each connection â‰ˆ R/K.
  - Each connection gets an equal share of the link bandwidth.
### Considerations
- **TCP Connections through Bottleneck Link**:
  - K connections with different end-to-end paths but passing through a bottleneck link with transmission rate R.

- **Ideal Scenario**:
  - Each connection sharing equally the link bandwidth.
  - Throughput along 45-degree arrow from origin.
### Case of Two TCP Connections
- **Assumptions**:
  - Same MSS, RTT, and large amount of data to send.
  - Ignoring slow-start phase and assuming TCP operates in congestion avoidance mode (AIMD).

- **Throughput Realization**:
  - Throughput at point A, then point B due to packet loss, then point C after decreasing window sizes.
  - Bandwidth use fluctuates along equal bandwidth share line.

- **Convergence to Fairness**:
  - Regardless of initial conditions, connections converge to equal sharing of bandwidth.
  - Idealized scenario provides intuitive understanding of TCP fairness.
