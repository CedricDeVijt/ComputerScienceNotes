## 3.3.1 Reliable Data Transfer Service Abstraction
### Service Model
- **Reliable Channel**: Upper-layer entities are provided with a reliable channel for data transfer.
  - **No Corruption**: No data bits are corrupted or lost during transfer.
  - **Ordered Delivery**: All data is delivered in the order it was sent.
### TCP Service Model
- **Offered Service**: TCP provides precisely this service model to Internet applications.
- **Reliability**: TCP ensures data integrity, order preservation, and delivery without loss.
### Implementation Challenges
- **Underlying Layer Reliability**: Reliable data transfer protocol may be implemented on top of an unreliable layer.
  - **Example**: TCP over the unreliable IP network layer.
- **Unreliable Channel**: Lower layer may be a single physical link or a global internetwork.
### Reliable Data Transfer Protocol
- **Sender Responsibilities**: Implemented by reliable data transfer protocol.
  - **rdt_send()**: Invoked from above to send data.
  - **Passing Data**: Data is passed to the upper layer at the receiving side.
- **Receiver Responsibilities**:
  - **rdt_rcv()**: Called when a packet arrives from the receiving side of the channel.
  - **Data Delivery**: Data delivered to upper layer using deliver_data().
### Implementation Details
- **rdt Protocol**: Reliable data transfer protocol.
- **_send**: Indicates the sending side of the protocol.
- **_rcv**: Indicates the receiving side of the protocol.
- **deliver_data()**: Method used for delivering data to the upper layer.

![[Screenshot 2024-03-21 at 13.12.15.png]]

## 3.3.2 Finite-State Machine (FSM) for Reliable Data Transfer Protocol
### Overview
- **Separate FSMs**: Exist for both sender and receiver.
- **Transitions**: Arrows indicate protocol transition based on events.
- **Actions**: Events and actions denoted above and below horizontal lines, respectively.
### Example: Message Dictation Protocol
- **Scenario**: Dictating a message over the phone.
- **Control Messages**: Positive acknowledgments ("OK") and negative acknowledgments ("Please repeat that.").
### ARQ (Automatic Repeat reQuest) Protocols
- **Fundamental Capabilities**:
  - **Error Detection**: Mechanism to detect bit errors.
  - **Receiver Feedback**: Receiver provides feedback to sender.
  - **Retransmission**: Resending packets received in error.
### Send-Side States
- **Waiting for Data**: Sender waits for data from upper layer.
  - **Event**: Data received from upper layer.
  - **Action**: Create packet with data and checksum, send via network layer.
- **Waiting for ACK or NAK**: Sender waits for acknowledgment or negative acknowledgment from receiver.
  - **Events**:
    - ACK received: Most recent packet received correctly.
    - NAK received or timeout: Retransmit last packet.
  - **Action**: Return to waiting for data after ACK, continue waiting for ACK/NAK after retransmission.
### Stop-and-Wait Protocol
- **Sender Behaviour**: Does not request new data until receiver acknowledges current packet.
- **Behaviour Name**: Such protocols are known as stop-and-wait protocols.

![[Screenshot 2024-03-21 at 15.31.02.png]]

## 3.3.3 Flaw in Simple Stop-and-Wait Protocol
### Oversight
- **ACK/NAK Corruption**: Possibility of corruption in ACK or NAK packets not considered.
### Consequences
- **Fatal Flaw**: Oversight leads to potential errors in the protocol operation.
### Solution: Checksum Addition
- **Checksum Bits**: Add checksum bits to ACK/NAK packets to detect errors.
### Recovery from Corrupted ACK/NAK
- **Resending Current Data Packet**: Sender resends current data packet upon receiving garbled ACK/NAK.
  - **Duplicate Packets**: Resending introduces duplicate packets in sender-to-receiver channel.
- **Ambiguity**: Receiver can't determine if the arriving packet is new data or a retransmission due to lack of knowledge about the ACK/NAK status.
### Sequence Number Solution
- **Adding Sequence Numbers**: Sender numbers its data packets by adding a sequence number field to data packets.
- **Receiver Check**: Receiver checks sequence number to identify retransmissions.
  - **1-Bit Sequence Number**: Sufficient for stop-and-wait protocol; allows receiver to differentiate between new and resent packets.
### Handling Packet Loss
- **Sender Responsibility**: Detection and recovery from lost packets handled by the sender.
- **Retransmission**: Sender waits until certain a packet is lost, then retransmits the data packet.
  - **Effective Protocol**: Ensures reliable data transfer despite potential packet loss.
## 3.3.4 Operation of the Alternating-Bit Protocol
### No Lost or Delayed Packets (Left Figure)
- **Normal Operation**: Protocol operates smoothly without any lost or delayed packets.
- **Packet Handling**: Data packets are sent, received, and acknowledged without issues.
### Handling Lost Data Packets (Middle and Right Figures)
- **Timeout Expiration**: Occurs when no ACK is received within a specified time.
- **Retransmission**: Sender retransmits the same packet (e.g., with sequence number 1).
- **Packet Sequence Numbers**: Alternates between 0 and 1.
- **Alternating-Bit Protocol**: Protocol is named as such due to alternating packet sequence numbers.
### Time Flow
- **Time Direction**: Moves forward from top to bottom of the diagram.
- **Receive Time vs. Send Time**: Receive time for a packet is later than the send time due to transmission and propagation delays.

![[Screenshot 2024-03-21 at 15.36.51.png]]
### Determining Retransmission Timeout
- **Minimum Wait Time**:
  - Sender waits at least as long as round-trip delay between sender and receiver.
  - Includes buffering time at intermediate routers and processing time at the receiver.
- **Challenges**:
  - Estimating Worst-case Maximum Delay:
    - Difficult to estimate accurately in many networks.
  - Ideal Recovery Time:
    - Protocol should recover from packet loss as soon as possible.
    - Waiting for worst-case delay may lead to prolonged error recovery.
- **Practical Approach**:
  - Sender judiciously chooses a timeout value.
  - Timeout chosen such that packet loss is likely but not guaranteed.
  - Retransmission occurs if ACK is not received within this time frame.

![[Screenshot 2024-03-21 at 15.38.36.png]]

### Stop-and-wait does not offer good performance

![[Screenshot 2024-03-21 at 15.39.41.png]]

## 3.3.5 Understanding Go-Back-N Protocol
### Introduction to Go-Back-N Protocol
- **Sender Behaviour**: Sender can transmit multiple packets without waiting for acknowledgment.
- **Constraint**: Maximum allowable number of unacknowledged packets is N.
- **Definitions**:
  - *base*: Sequence number of the oldest unacknowledged packet.
  - *nextseqnum*: Smallest unused sequence number for the next packet.
### Sequence Number Intervals
- **Intervals**:
  - [0,base-1]: Packets transmitted and acknowledged.
  - [base,nextseqnum-1]: Sent but not yet acknowledged.
  - [nextseqnum,base+N-1]: Available for immediate sending.
  - >= base+N: Unusable until acknowledged.
### Sliding-Window Concept
- **Window Size**: N.
- **Concept**: Window slides forward over sequence number space.
- **Terminology**: GBN protocol as a sliding-window protocol.
### Justification for Limiting Outstanding Packets
- **Flow and Congestion Control**: Limiting relates to these functionalities.
- **Explanation**: Further discussion in the context of TCP.
### Packet Structure
- **Sequence Number Field**: Carried in fixed-length field in packet header.
- **Calculation**: Range of sequence numbers \[0, 2^k - 1\].
- **Arithmetic**: Modulo 2^k arithmetic for sequence numbers.
### Acknowledgment Handling
- **Cumulative Acknowledgment**: Acknowledgment for packet n includes all packets up to n.
- **Behaviour**: Protocol's name "Go-Back-N" derived from sender's behaviour with lost or delayed packets.
- **Recovery Mechanism**: Timer-based recovery similar to stop-and-wait protocol.
  - Timeout: Resend all unacknowledged packets.
  - Received ACK with unacknowledged packets: Restart timer.
  - No outstanding packets: Stop timer.

![[Screenshot 2024-03-21 at 15.49.12.png]]

## 3.3.6 Receiver Actions in Go-Back-N Protocol
### Normal Packet Reception
- **Scenario**: Packet with sequence number n received correctly and in order.
- **Action**:
  - Send ACK for packet n.
  - Deliver data portion of packet to upper layer.
### Handling Out-of-Order Packets
- **Discard Policy**: Receiver discards out-of-order packets.
- **Justification**: Need for delivering data in order.
- **Example Scenario**:
  - Expected packet: n
  - Received packet: n + 1
- **Explanation**:
  - Receiver could buffer n + 1, but it chooses to discard it.
  - If n is lost, it and n + 1 will be retransmitted as per GBN rule.
- **Advantage**:
  - Simplicity of receiver buffering.
- **Receiver's Information Maintenance**:
  - Variable: *expectedseqnum* holds sequence number of next in-order packet.
- **Disadvantage**:
  - Potential loss or corruption of subsequent retransmissions.
### Cumulative Acknowledgments
- **Reasoning**: Since packets are delivered one at a time, cumulative acknowledgments are natural.
- **Implication**: Delivery of packet k implies delivery of all packets with sequence numbers lower than k.

![[Screenshot 2024-03-21 at 15.54.41.png]]

## 3.3.7 Selective-Repeat Protocol: Sender and Receiver Actions
### Data Reception from Above
- **Sender Action**:
  - Check next available sequence number.
  - If within sender's window:
    - Packetise and send.
  - Otherwise:
    - Buffer or return to upper layer.
### Timeout Handling
- **Timeout Mechanism**:
  - Each packet has its own logical timer.
  - Single hardware timer used to mimic multiple logical timers.
### Handling ACKs
- **ACK Reception**:
  - Mark received packet within window.
  - If packet's sequence number equals send_base:
    - Move window base forward to smallest unacknowledged sequence number.
    - Transmit any untransmitted packets now within the window.
### Receiver Actions
#### Packet Received within Receiver Window
- **Scenario**:
  - Packet sequence number in [rcv_base, rcv_base + N - 1].
- **Action**:
  - Generate selective ACK packet to sender.
  - Buffer if not previously received.
  - If sequence number equals rcv_base:
    - Deliver to upper layer with consecutively numbered packets.
    - Move receive window forward by the number of delivered packets.
#### Packet Received Outside Receiver Window
- **Scenario**:
  - Packet sequence number in [rcv_base - N, rcv_base - 1].
- **Action**:
  - Generate ACK, even if previously acknowledged.
#### Other Cases
- **Action**:
  - Ignore the packet.

![[Screenshot 2024-03-21 at 16.03.54.png]]
![[Screenshot 2024-03-21 at 16.04.19.png]]
![[Screenshot 2024-03-21 at 16.04.29.png]]
