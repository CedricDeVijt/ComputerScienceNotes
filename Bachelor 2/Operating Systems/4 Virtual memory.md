# Virtual Memory and Memory Management

## Chapter 4.1: Introduction to Virtual Memory

### Memory Management
- Processes are no longer stored as a single contiguous block in memory.
- **Paging**: Some pages of a process are loaded into memory, while others reside in the **swap space** (disk).
- **Logical to Virtual Address Translation**: Logical addresses generated by the process are converted into virtual addresses. This allows addressing larger process images than the available physical memory.

### Key Concepts
- **Page Hit**: When a required page is already in main memory, similar to a cache hit.
- **Page Fault**: Occurs when the page is not in main memory and must be fetched from swap space, potentially slowing execution.
- **Page Table**: Maps virtual addresses to physical memory addresses.

![[Pasted image 20241028135433.png]]
![[Pasted image 20241028135446.png]]

## Chapter 4.2: Virtual Memory Layout

### Virtual Memory Organization
- **Page Table Organization**: Maintains frame numbers for entries that are present in physical memory.
- **Segmentation Fault**: Errors resulting from accessing unauthorized memory segments.

![[Pasted image 20241028140214.png]]

## Chapter 4.3: Organization and Optimization of Page Tables

### Desirable Features of Page Tables
- The entire page table should be kept in memory for quick access.
- The starting address of the page table should be stored in a processor register.
- The page number serves as an index for the page table.

### Problems with Large Page Tables
- Page tables can become excessively large, consuming significant memory.
- Direct indexing of page numbers is inefficient with sparse memory usage.

### Solutions

#### Multilevel Page Tables
- **Structure**:
  - Divides the page table into levels (e.g., Level 1, Level 2).
  - Only the active parts of the page table are stored in memory, reducing memory overhead.
- **Benefits**: Saves memory by avoiding storage of unused table entries.

![[Screenshot 2024-10-28 at 14.07.33.png]]

#### Inverted Page Tables
- Maintains one entry per physical frame rather than per virtual page.
- Uses **hashing** for efficient page lookups.
- **Trade-offs**: Smaller table size but requires complex search algorithms.

![[Pasted image 20241028140949.png]]

## Chapter 4.4: Translation Lookaside Buffer (TLB)

### Purpose
- A hardware-based cache to reduce the need for frequent virtual-to-physical address translations.

### Operation
- Stores recent (VPN, frame number) pairs for faster lookup.
- **TLB Miss**: When a virtual page number is not found in the TLB, the page table must be accessed.

### Context Switching
- On a process switch, the TLB must be flushed as the mappings correspond to the previous process.

![[Pasted image 20241028142753.png]]

## Chapter 4.5: Software Support in Virtual Memory

### Address Translation
- Performed primarily by hardware.
- Page faults are handled by the operating system.

### Frame Allocation
- **Resident Set Management**: Determines the number of pages allocated per process.
- **Replacement Algorithms**: Identify which page should be replaced when memory is full.

## Chapter 4.6: Page Replacement Algorithms

### Types of Algorithms
1. **Optimal Algorithm (OPT)**:
   - Replaces pages that will not be needed for the longest time.
   - Acts as a benchmark but isn’t feasible in real systems.

2. **Least Recently Used (LRU)**:
   - Replaces the least recently accessed page.
   - Drawbacks:
     - Requires frequent updates.
     - Ignores page access frequency.

3. **First-In-First-Out (FIFO)**:
   - Replaces the oldest loaded page.
   - **Belady’s Anomaly**: Adding more memory can lead to more page faults.

4. **Clock Algorithm (CLOCK)**:
   - Uses a circular buffer with "use bits" to approximate LRU behavior efficiently.
   - Reduces complexity and overhead.

![[Pasted image 20241028145346.png]]
![[Pasted image 20241028142846.png]]

## Chapter 4.7: Resident Set Policy

### Key Features
- **Fixed vs. Variable Allocation**:
  - **Fixed Allocation**: A fixed number of pages is allocated per process.
  - **Variable Allocation**: Pages can be dynamically allocated based on process needs.
- **Active Working Set W(t, ∆)**:
  - Defines the set of pages needed by a process in a recent time window.
  - Helps in monitoring and adjusting page allocations.

### Restrictions
- Frames belonging to the operating system are never eligible for replacement.

---

# Key Points to Remember

- **Memory Management**: Processes utilize paging to handle larger images than available physical memory.
- **Page Tables**:
  - Essential for mapping virtual addresses to physical memory efficiently.
  - Multilevel and inverted page tables address memory and lookup efficiency challenges.
- **TLB**: Reduces address translation times by caching page table entries.
- **Replacement Algorithms**:
  - **OPT**: Ideal but theoretical.
  - **LRU**: Practical with limitations.
  - **FIFO**: Simple but prone to anomalies.
  - **CLOCK**: Balances FIFO and LRU, requiring minimal updates.
- **Resident Set Policy**:
  - Fixed allocation is simpler; variable allocation adapts to changing process demands.
  - The active working set helps optimize memory usage dynamically.

